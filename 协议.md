# TCP/IP

## 1

链路层:地址解析协议ARP,IPv4的同用协议

分组交换:通信双方以分组为单位,使用存储-转发机制实现数据交换,存在时延
优点:

  1. 链路利用率高
  2. 可实行数据率转换
  3. 为分组设置优先级,增加延时并减少阻塞

缺点:

  1. 通过分组交换网节点时产生时延(等候)
  2. 存在时延抖动,各分组时延变化大
  3. 开销大(组头占用额外开销)
PS: 此机制下的分组先在交换机中临时存储,适时(选择合适的物理线路)发出

IP转发类型:

1. 单薄(一台主机)
2. 广播(指定网格中的所有主机)
3. 组播(一个组播组中的一组主机)

IP层: ICMP,IGMP
控制层:

  1. TCP: 传输控制协议:处理数据包丢失,重复,重新排序;面向连接;不保存消息边界
    1. 涉及工作:
      1. 将应用数据分解成块;
      2. 确认接收到的分组,设置超时
  
  2. UDP: 用户数据协议: 保留消息边界;不强制速率控制,差错控制;不保证可靠性
  3. DCCP: 数据报拥塞控制协议:面向连接;不可靠数据连接;拥塞控制
  4. SCTP: 流控制传输协议:可靠交付,但不严格保证顺序;多个数据流在同一连接上传输,抽象消息返回

## 复用,分解,封装

以太网帧:

  1. 48位目的地址(MAC介质访问控制地址)
  2. 16位以太网类型
     1. 0x0800 IPv4
     2. 0x8006 ARP
     3. 0x86DD IPv6

分解:帧包含IP数据报,以太网头尾部信息清除,交给IP处理,若目的地址与自己的一个IP匹配,且数据报头部无误,则根据IPv4协议字段决定调用哪个协议处理

  1. 1  ICMP;
  2. 2  IGMP
  3. 4  IPv4
  4. 6  TCP
  5. 17  UDP

端口号: 16位非整数 不对应任何物理设备,由IANA Internet号码分配机构分配
范围:

  1. <= 1023   熟识
  2. <= 49151  注册
  3. <= 65535  私有

熟识:SSH 22;FTP 20,21;Telnet远程控制  23;SMTP 25;DNS 53; HTTP 80;HTTPS 443;IMAP 143;IMAPS 993;SNMO  161,162; LDAP: 389

DNS 是一个分布式数据库,主机名与IP地址间的映射,应用层协议

IP路由器,专用设备 不同物理网络的连接(以太网,Wi-Fi,点到点链路,DSL)

应用层网关ALG:作为一个特定应用,连接两个不同协议族(TCP/IP和IBM的SNA)

### 网络应用基本结构

1. 客户机/服务器
2. 对等

服务器分类:

1. 迭代: 步骤
   1. 等客户机请求到达
   2. 处理
   3. 响应经请求客户机
   4. 回1
2. 并发:步骤:
   1. 同上
   2. 启用新的服务器实例处理客户机全部请求,任务完成后新服务终止

对等结构特点:
每个应用既是客户机,又是服务器,并能转发请求:如 skype,BitTorent 称为P2P应用
工作原理:并发P2P应用接受到传入的请求,确定它是否能响应这个请求,如果不能,将这个请求转发给其他对等方
发现服务: 一个对等方如向在网络中发现提供他所需的数据服务的其他对等方及其他需求交互的那些对等方的位置

网络攻击:

1. 欺骗:在自己发送的每个IP数据报的源地址中插入任意IP地址
2. DoS拒绝服务: 消耗大量主要资源,以致合法用户被拒绝服务

IPv6地址表示规则:  8块由冒号分隔,每块16byte

1. 每块的前导0可不写: 0058 -> 58
2. 全0块省略: 2001:0db8:0:0:0:0:0:2 -> 2001:db8::2
3. IPv4混合:(表示可能有误)
   1. IPv4 -> IPv6: ::ffff:10:0:0:0:1
   2. IPv6 -> IPv4: ::0102:f001  取低位

> PS: 省略0块仅能一次,且多者,前者优先

Ipv6网址: `http://[{IPv6}]:443`

IP地址用于识别连接Internet或内联网的计算机网络接口时称单播地址

IP地址结构:
| 类别   | 网络号 | 主机号 |
| ------ | ------ | ------ |
| A 0    | 8      | 24     |
| B 10   | 16     | 16     |
| C 110  | 24     | 8      |
| D 1110 | 32     |        |
| E 1111 | 32     |        |

> PS: 网络号部分前几位用于区分网络类别,可用范围应当减去

子网寻址:扩展站点子网数(缓解A,B类网络数较少,主机数较多).由划分子网的网络中的主机和路由器执行子网
过程:从主机号中分配一定位数作为子网ID,该站点通过网络号+加子网ID区分该节点子网
子网掩码:子网寻址过程中,通过子网掩码与IP地址作逻辑与运算得到子网.边界路由器进行数据转发.所有子网用于站点内,站点外只看网络号
子网掩码易记格式:

1. 255.0.0.0 -> /8  前8位是1
2. 255.192.0.0 -> /10  前10位是1

IP和子网掩码结合表示: 128.192.0.0/16

子网掩码会决定网络的拓扑结构
问题:网络如何承载数十亿的终端?

广播地址:子网+全部置为1的主机号. 用于IPv4,IPv6有组播功能,本地网络会转发给其他子网中的所有主机(除非终端明确禁用)
  算法:地址,逻辑或,掩码取反
  注意:路由器默认不转发

IPv6特点:

1. 地址范围(网络规模):
   1. 节点本地(只用于同一计算机中通信)
   2. 链路本地(只用于同一链路或IPv6前缀中的)
      1. 使用接口标识符(IID)(64位,链路层MAC形成EUI(扩展唯一标识符))作为单播地址分配基础
   3. 全球性(Internet范围)

EUI:

1. 24位   组织唯一标识符(OUI)(第一个字节低2位分别为U(通用/本地),g(个人/组播))
2. 40位   扩展标识符

分配各种尺寸的IP地址块:无类别域网路由(CIDR)
类似子网掩码,但不作用与一个站点而是全球性的路由系统以缓解各种分配不均
例: 128.0.0.0/24   前24位固定,其余位变化

路由聚合 减少理由边表组数
路由表组: 指示路由器向哪转发流量
实现过程:将相邻的多个IP前缀合并成一个短前缀
  如: 190.154.27.0/26;190.154.27.64/26 => 190.154.27.0/25

网络地址转换(NAT)
专用网络(10/8,172.16/12,192.168/16)用于内部主机和路由器之间的通信

IPv4,IPv6 地址转换
嵌入IPv4的IPv6: 前缀长度为32,40,48,56,64,96(有后缀应为0,64~71应为0)
任意组播(ASM):任意发送均可发送给任意组

一台主机向一个组播IP发送数据,创建一个数据报,该主机IP作为源地址,加入组的所有主机将接收该组的任何数据报

Q: 组播IP数据有限,若不足,如何处理?一个直播件就是一个组播IP?

### 链路层

以太网: 一套标准,(多个)站在共享介质中传递数据
  接口实接现:
    带冲突检测的载波侦听多路访问(CSMA/CD)算法
      原理: 检测网格上正在发送的信号,并在[??]时发送自己的帧
      作用: 协调哪些计算机可以访问共享介质(电缆)

若其他站[??]的发送发生重叠的电信号被检测为一次碰撞,每个[???]一个随机时间再尝试发动

CSMA/CD访问方式称介质访问控制协议(MAC)

公共介质(电缆) --> 交换机(星形拓扑结构,全双工,不需要CSMA/CD)
以太网的有效载荷:1500字节
帧校验序列/循环冗余校验(CRC) 参考书

Q: 在CSMA/CD下,一帧能走多远?
A: 帧大小/带宽*电子速度=64*8/(10*10e6)*0.71c=11000m

链路聚合控制协议

双工不匹配:
  计算机与交换机端口使用不同的双工配置且自动协[?]在一端禁用时,连接不完全失败,性能性能下降

唤醒功能网络接口主机脱离[????]状态,可被几种帧触发

输出端口争用:多个端发送到同一目的地

流量控制:PAUSE消息包含在MAC帧中,可在帧格式中找到
Q:: 路由器的限量是不是这样

网挤:连接多个物理的链路后网路组成网络

通过学习,网格知道MAC地址可由哪个端口到达,存储在过滤数据库中

洪流:网格的过滤数据中来在匹配目标地址,便将帧发[??]接受端口之[?]的所欲端口

## 概念

协议: 程序或规则系统
协议族: 一系列相关的协议集合
协议族体系结构:协议族中各协议相互关系并划分需要完成的任务
分组:亦称包,被划分成等长的数据段,其首部含有目标地址等控制信息
面向连接: 通信过程: 连接建立,传递信息,连接拆除.特点:所有通信数据通过建立的连接传递;保证有序;时延较小
无连接工作:一边找路,一边传递;不保证有序(接受,发送顺序不一致);时延较大;对网络故障不敏感
统计复用:亦称异步时分复用,根据信息到达的快慢随机插入ATM复用线
差错控制:处理网络数据损坏,丢失
协议分层复用:协议数据单元PDU,被底层携带
多宿主:有多个接口的系统
IP数据报:IP发送给链路层的协议的PDU,64KB
分片:将过大的分组放入链路PDU进行缩小处理的过程
转发:决定和发送数据报到下一跳
ICMP: Internet控制消息协议:用于主机与路由器间交换差错消息等.诊断工具(ping,traceroute)使用此
IGMP: Internet组管理协议:组播寻址和交付管理组播成员主机
覆盖网络:一组P2P应用共同形成一个应用网络
可变长子网掩码(VLSM)
源特定组播(SSM): 一个组只有一个发送方
网络时间协议(NTP)
会话通告协议(SAP)
会话描述协议(SDP)
以太网帧格式(PDU)
